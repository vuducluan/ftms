<% if user_subject.is_of_user?(current_user) || user_task.assigned? %>

  <hr />
  <li class="list-item mbm pbm por" id="course-overview">
    <div class="bucket bucket--flag">
      <div class="bucket-media dn db--m">
        <div class="badge">
          <%= image_task_tag user_task %>
        </div>
      </div>
      <div class="bucket-content">
        <h3 class="h h--3">
          <b class="h-label opf">
            <span class="prs <%= style_of_status user_task.status %>">
              <%= t "tasks.statuses.#{Settings.tasks.statuses.key(user_task.status)}" %>
            </span>
            <span class="bdrl pls tch"><%= "#{user_task.progress} %" %></span>
          </b>
          <%= link_to user_task.task_name,
            course_subject_task_path(@user_subject.course_subject, user_task.task) %>
          <% if current_user?(user_task.user) && user_task.subject_in_progress? &&
            user_task.status != Settings.tasks.statuses.closed %>
            <h4>
              <%= link_to t("subjects.task.edit"), "#", class: "db di--m tch tsxs",
                data: {toggle: "modal", target: "#user-task-#{user_task.id}"} %>
              <div id="user-task-<%= user_task.id %>" class="modal fade" role="dialog">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal">&times;</button>
                      <h4 class="label-modal"><%= t "tasks.edit" %></h4>
                    </div>
                    <div class="modal-body modal-user-task">
                      <%= render partial: "user_tasks/edit", locals: {user_task: user_task} %>
                    </div>
                  </div>
                </div>
              </div>
            </h4>
          <% end %>
        </h3>
        <div id="tasks">
          <div class="row">
            <%= form_for user_task.task, url: course_task_path(@course.id,user_task.task_id),
              html: {method: :put} do |f| %>
              <div class="col-md-2">
                <%= f.label :assigned_trainee_id, I18n.t("subjects.task.assigned"), class: "label" %>
              </div>
              <div class="col-md-3">
                <% if user_task.nil_master? && user_task.subject_in_progress? %>
                  <div class="assign-other">
                    <%= f.select :assigned_trainee_id,
                      @user_subjects.collect{|user_subject| [user_subject.user_name,
                        user_subject.user_id]},
                      {prompt: ""}, onchange: "this.form.submit()",
                      class: "select-assign form-control" %>
                  </div>
                <% else %>
                  <div class= "assigned-user">
                    <%= user_task.user_name %>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
        <p class="mbf task-description"><%= user_task.task_description %></p>
      </div>
    </div>
  </li>
<% end %>
